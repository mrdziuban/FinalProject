<!DOCTYPE html>
<html>
<head>
  <title>GameDay</title>
  <%= stylesheet_link_tag    "application", :media => "all" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
  <link href='http://fonts.googleapis.com/css?family=Raleway:400,800,500,600' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
  <link rel="shortcut icon" href="/favicon.png"
  <meta name="google" value="notranslate">
</head>
<body>

  <% if current_user %>
    <header>
      <nav class="navbar">
        <ul class="options group">
          <li class="logo"><a href="<%= user_root_url %>">HOME</a></li>
          <li><a href="<%= user_url(current_user.username) %>">PROFILE</a></li>
          <li class="stats">
            <a href="#">STATS</a>

            <ul class="dropdown group">
              <li><a href="<%= standings_url %>">STANDINGS</a></li>
              <li class="players-option">PLAYERS
                <ul class="players-sidedrop">
                  <li><a href="<%= players_url %>">SKATERS</a></li>
                  <li><a href="<%= goalies_url %>">GOALIES</a></li>
                </ul>
              </li>
              <li><a href="<%= games_url %>">SCHEDULE</a></li>
              <li><a href="<%= analyses_url %>">ANALYSIS</a></li>
            </ul>
          </li>
          <li><a href="#">FORUM</a></li>
          <span class="navbar-float-right">
            <li><input type="text" placeholder="Search teams and players..." class="search-bar"></li>
            <li><%= link_to "SIGN OUT", destroy_user_session_url, method: :delete %></li>
          </span>
        </ul>
      </nav>
    </header>
  <% end %>

  <div class="search-results-hidden">
    <section class="search-results">
    </section>
  </div>

<%= yield %>

</body>
</html>

<script>
  $(document).ready(function () {
    $(".stats").mouseenter(function () {
      $(".dropdown").slideDown("fast");
    });
    $(".stats").mouseleave(function () {
      $(".dropdown").slideUp("fast");
    });

    $(".players-option").mouseenter(function () {
      $(".players-sidedrop").animate({width: "toggle"}, "fast");
    });
    $(".players-option").mouseleave(function () {
      $(".players-sidedrop").animate({width: "toggle"}, "fast");
    });

    var names = <%= raw Team.pluck("name") + Player.pluck("name") + Goalie.pluck("name") %>;

    $(".search-bar").typeahead({
      name: "names",
      local: names
    });

    $("span.navbar-float-right > li input").keypress(function (event) {
      if (event.which === 13) {
        var that = this;
        var data = {query: $(this).val()};

        $.ajax({
          url: "<%= search_url %>",
          type: "POST",
          data: data,
          success: function (data) {
            $(".search-results").html(data);
            $(that).blur();
            $(".search-results-hidden").fadeIn("fast");
          },
          error: function () {
            console.log("error");
          }
        });
      }
    });

    $(".search-results").on("click", function (event) {
      event.stopPropagation();
    });

    $("div.search-results-hidden").on("click", function () {
      $(this).fadeOut("fast");
    })
  });
</script>
